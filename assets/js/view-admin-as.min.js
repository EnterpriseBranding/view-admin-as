;/**
 * View Admin As
 * https://wordpress.org/plugins/view-admin-as/
 *
 * @author  Jory Hogeveen <info@keraweb.nl>
 * @package view-admin-as
 * @since   0.1
 * @version 1.6.4
 * @preserve
 */
if("undefined"===typeof VAA_View_Admin_As){var VAA_View_Admin_As={ajaxurl:null,siteurl:"",view_as:false,view_types:["user","role","caps","visitor"],_debug:false,_vaa_nonce:"",__no_users_found:"No users found.",__success:"Success",__confirm:"Are you sure?"}}(function($){VAA_View_Admin_As.prefix="#wpadminbar #wp-admin-bar-vaa ";VAA_View_Admin_As.root="#wp-admin-bar-vaa";if("undefined"===typeof VAA_View_Admin_As._debug){VAA_View_Admin_As._debug=0}else{VAA_View_Admin_As._debug=parseInt(VAA_View_Admin_As._debug,10)}if("undefined"===typeof VAA_View_Admin_As.ajaxurl&&"undefined"!==typeof ajaxurl){VAA_View_Admin_As.ajaxurl=ajaxurl}VAA_View_Admin_As._touchmove=false;$(document).on("touchmove",function(){VAA_View_Admin_As._touchmove=true});$(document).on("touchstart",function(){VAA_View_Admin_As._touchmove=false});VAA_View_Admin_As.init=function(){VAA_View_Admin_As.init_caps();VAA_View_Admin_As.init_users();VAA_View_Admin_As.init_settings();VAA_View_Admin_As.init_module_role_defaults();$(window).on("load",function(){$(VAA_View_Admin_As.prefix+".ab-vaa-toggle").each(function(){var toggleContent=$(this).parent().children().not(".ab-vaa-toggle");if(!$(this).hasClass("active")){toggleContent.hide()}$(this).on("click touchend",function(e){e.preventDefault();e.stopPropagation();if(true===VAA_View_Admin_As._touchmove){return}if($(this).hasClass("active")){toggleContent.slideUp("fast");$(this).removeClass("active")}else{toggleContent.slideDown("fast");$(this).addClass("active")}});$(this).on("keyup",function(e){e.preventDefault();var key=parseInt(e.which,10);if($(this).hasClass("active")&&(key===13||key===32||key===38)){toggleContent.slideUp("fast");$(this).removeClass("active")}else if(key===13||key===32||key===40){toggleContent.slideDown("fast");$(this).addClass("active")}})});$(VAA_View_Admin_As.prefix+".ab-vaa-showhide[data-showhide]").each(function(){$($(this).attr("data-showhide")).hide();$(this).on("mouseenter",function(){$($(this).attr("data-showhide")).slideDown("fast")}).on("mouseleave",function(){$($(this).attr("data-showhide")).slideUp("fast")})})});$(document).on("click touchend",VAA_View_Admin_As.prefix+".vaa-reset-item > .ab-item",function(e){e.preventDefault();if(true===VAA_View_Admin_As._touchmove){return}if($("button",this).attr("name")==="vaa_reload"){window.location.reload()}else{VAA_View_Admin_As.ajax({reset:true},true);return false}});$.each(VAA_View_Admin_As.view_types,function(index,type){$(document).on("click touchend",VAA_View_Admin_As.prefix+".vaa-"+type+"-item > a.ab-item",function(e){if(true===VAA_View_Admin_As._touchmove){return}e.preventDefault();if(!$(this).parent().hasClass("not-a-view")){var viewAs={};viewAs[type]=String($(this).attr("rel"));VAA_View_Admin_As.ajax(viewAs,true);return false}})});$(document).on("click touchend",VAA_View_Admin_As.prefix+".ab-item > .remove",function(e){e.preventDefault();if(true===VAA_View_Admin_As._touchmove){return}$(this).parent(".ab-item").slideUp("fast",function(){$(this).remove()})})};VAA_View_Admin_As.ajax=function(viewAs,reload){var body=$("body");$(".vaa-notice","#wpadminbar").remove();body.append('<div id="vaa-overlay"><span class="vaa-loader-icon" style="background: transparent url('+VAA_View_Admin_As.siteurl+'/wp-includes/images/spinner-2x.gif) center center no-repeat; background-size: contain;"></span></div>');$("body #vaa-overlay").fadeIn("fast");var fullPopup=false;if($(VAA_View_Admin_As.prefix).hasClass("fullPopupActive")){fullPopup=true;$(VAA_View_Admin_As.prefix).removeClass("fullPopupActive")}var data={action:"view_admin_as",_vaa_nonce:VAA_View_Admin_As._vaa_nonce,view_admin_as:JSON.stringify(viewAs)};var isView=false;$.each(VAA_View_Admin_As.view_types,function(index,type){if("undefined"!==typeof viewAs[type]){isView=true;return true}});if($(VAA_View_Admin_As.prefix+"#vaa-settings-view-mode-single").is(":checked")&&isView){body.append('<form id="vaa_single_mode_form" style="display:none;" method="post"></form>');var form=$("#vaa_single_mode_form");form.append('<input type="hidden" name="action" value="'+data.action+'">');form.append('<input type="hidden" name="_vaa_nonce" value="'+data._vaa_nonce+'">');form.append('<input id="data" type="hidden" name="view_admin_as">');form.find("#data").val(data.view_admin_as);form.submit()}else{$.post(VAA_View_Admin_As.ajaxurl,data,function(response){if(VAA_View_Admin_As._debug===1){console.log(response)}if(typeof response.success!=="undefined"&&true===response.success){if(false===reload){if("undefined"!==typeof response.data&&"undefined"!==typeof response.data.content){if(typeof response.data.type==="undefined"){response.data.type="default"}if("object"!==typeof response.data.content){response.data.content=String(response.data.content)}VAA_View_Admin_As.overlay(response.data.content,String(response.data.type))}else{$("body #vaa-overlay").addClass("success").fadeOut("fast",function(){$(this).remove()});VAA_View_Admin_As.notice(VAA_View_Admin_As.__success,"success")}}else{window.location.hash="";window.location.replace(window.location.href.replace("#","").replace("?reset-view","").replace("&reset-view","").replace("?reset-all-views","").replace("&reset-all-views",""))}}else{$("body #vaa-overlay").addClass("error").fadeOut("fast",function(){$(this).remove()});if(true===fullPopup){$(VAA_View_Admin_As.prefix).addClass("fullPopupActive")}if("undefined"!==typeof response.data){if("undefined"!==typeof response.data.content){if("undefined"===typeof response.data.type){response.data.type="error"}VAA_View_Admin_As.notice(response.data.content,response.data.type)}else{VAA_View_Admin_As.notice(response.data,"error")}}}})}};VAA_View_Admin_As.notice=function(notice,type){var root="#wpadminbar .vaa-notice";$("#wp-admin-bar-top-secondary").append('<li class="vaa-notice vaa-'+type+'"><span class="remove ab-icon dashicons dashicons-dismiss" style="top: 2px;"></span>'+notice+"</li>");$(root+" .remove").click(function(){$(this).parent().remove()});setTimeout(function(){$(root).fadeOut("fast",function(){$(this).remove()})},5e3)};VAA_View_Admin_As.overlay=function(data,type){var root="body #vaa-overlay";$(root).html('<div class="vaa-overlay-container"><span class="remove dashicons dashicons-dismiss"></span><div class="vaa-response-data"></div></div>');if("undefined"!==typeof data.text){$(root+" .vaa-response-data").append("<p>"+data.text+"</p>")}if("textarea"===type){if("undefined"!==typeof data.textareacontent){$(root+" .vaa-response-data").append('<textarea style="width: 100%;" readonly>'+data.textareacontent+"</textarea>");$(root+" .vaa-response-data textarea").click(function(){$(this).select()})}}else if("errorlist"===type){if("undefined"!==typeof data.errors){$(root+" .vaa-response-data").append('<ul class="errorlist"></ul>');data.errors.forEach(function(error){$(root+" .vaa-response-data .errorlist").append("<li>"+error+"</li>")})}}else{$(root+" .vaa-response-data").append("<div>"+data+"</div>")}$(root+" .vaa-overlay-container .remove").click(function(){$(root).fadeOut("fast",function(){$(this).remove()})});$(document).mouseup(function(e){$(root+" .vaa-overlay-container").each(function(){if(!$(this).is(e.target)&&0===$(this).has(e.target).length){$(root).fadeOut("fast",function(){$(this).remove()})}})})};VAA_View_Admin_As.init_settings=function(){var root=VAA_View_Admin_As.root+"-settings",prefix="vaa-settings",root_prefix=VAA_View_Admin_As.prefix+root;$(document).on("change",root_prefix+"-admin-menu-location select#"+prefix+"-admin-menu-location",function(e){e.preventDefault();var val=$(this).val();if(val&&""!==val){var viewAs={user_setting:{admin_menu_location:val}};VAA_View_Admin_As.ajax(viewAs,true)}});$(document).on("change",root_prefix+"-view-mode input.radio."+prefix+"-view-mode",function(e){e.preventDefault();var val=$(this).val();if(val&&""!==val){var viewAs={user_setting:{view_mode:val}};VAA_View_Admin_As.ajax(viewAs,false)}});$(document).on("change",root_prefix+"-force-group-users input#"+prefix+"-force-group-users",function(e){e.preventDefault();var viewAs={user_setting:{force_group_users:"no"}};if(this.checked){viewAs={user_setting:{force_group_users:"yes"}}}VAA_View_Admin_As.ajax(viewAs,true)});$(document).on("change",root_prefix+"-hide-front input#"+prefix+"-hide-front",function(e){e.preventDefault();var viewAs={user_setting:{hide_front:"no"}};if(this.checked){viewAs={user_setting:{hide_front:"yes"}}}VAA_View_Admin_As.ajax(viewAs,false)});$(document).on("change",root_prefix+"-freeze-locale input#"+prefix+"-freeze-locale",function(e){e.preventDefault();var viewAs={user_setting:{freeze_locale:"no"}};if(this.checked){viewAs={user_setting:{freeze_locale:"yes"}}}var reload=false;if(typeof VAA_View_Admin_As.view_as==="object"&&typeof VAA_View_Admin_As.view_as.user!=="undefined"){reload=true}VAA_View_Admin_As.ajax(viewAs,reload)})};VAA_View_Admin_As.init_users=function(){var root=VAA_View_Admin_As.root+"-users",root_prefix=VAA_View_Admin_As.prefix+root;$(document).on("keyup",root_prefix+" .ab-vaa-search.search-users input",function(){$(VAA_View_Admin_As.prefix+" .ab-vaa-search #vaa-searchuser-results").empty();if(1<=$(this).val().length){var inputText=$(this).val();$(VAA_View_Admin_As.prefix+".vaa-user-item").each(function(){var name=$(".ab-item",this).text();if(-1<name.toLowerCase().indexOf(inputText.toLowerCase())){var exists=false;$(VAA_View_Admin_As.prefix+".ab-vaa-search #vaa-searchuser-results .vaa-user-item .ab-item").each(function(){if($(this).text().indexOf(name)>-1){exists=$(this)}});var role=$(this).parents(".vaa-role-item").children(".ab-item").attr("rel");if(false!==exists&&exists.length){exists.find(".user-role").text(exists.find(".user-role").text().replace(")",", "+role+")"))}else{$(this).clone().appendTo(VAA_View_Admin_As.prefix+".ab-vaa-search #vaa-searchuser-results").children(".ab-item").append(' &nbsp; <span class="user-role">('+role+")</span>")}}});if(""===$.trim($(VAA_View_Admin_As.prefix+".ab-vaa-search #vaa-searchuser-results").html())){$(VAA_View_Admin_As.prefix+".ab-vaa-search #vaa-searchuser-results").append('<div class="ab-item ab-empty-item vaa-not-found">'+VAA_View_Admin_As.__no_users_found+"</div>")}}})};VAA_View_Admin_As.init_caps=function(){var root=VAA_View_Admin_As.root+"-caps",root_prefix=VAA_View_Admin_As.prefix+root;VAA_View_Admin_As.caps_filter_settings={selectedRole:"default",selectedRoleCaps:{},selectedRoleReverse:false,filterString:""};VAA_View_Admin_As.filter_capabilities=function(){$(root_prefix+"-quickselect-options .vaa-cap-item").each(function(){var name;if(true===VAA_View_Admin_As.caps_filter_settings.selectedRoleReverse){$(this).hide();if(1<=VAA_View_Admin_As.caps_filter_settings.filterString.length){name=$(this).text();if(-1<name.toLowerCase().indexOf(VAA_View_Admin_As.caps_filter_settings.filterString.toLowerCase())){$(this).show()}}else{$(this).show()}if(VAA_View_Admin_As.caps_filter_settings.selectedRole!=="default"&&$("input",this).attr("value")in VAA_View_Admin_As.caps_filter_settings.selectedRoleCaps){$(this).hide()}}else{$(this).hide();if(VAA_View_Admin_As.caps_filter_settings.selectedRole==="default"||$("input",this).attr("value")in VAA_View_Admin_As.caps_filter_settings.selectedRoleCaps){if(1<=VAA_View_Admin_As.caps_filter_settings.filterString.length){name=$(this).text();if(-1<name.toLowerCase().indexOf(VAA_View_Admin_As.caps_filter_settings.filterString.toLowerCase())){$(this).show()}}else{$(this).show()}}}})};$(document).on("mouseenter",root_prefix+"-quickselect",function(){$(root_prefix+"-quickselect-options").css({"max-height":$(window).height()-350+"px"})});$(document).on("click",root_prefix+" #open-caps-popup",function(){$(VAA_View_Admin_As.prefix).addClass("fullPopupActive");$(root_prefix+"-quickselect > .ab-sub-wrapper").addClass("fullPopup")});$(document).on("click",root_prefix+" #close-caps-popup",function(){$(VAA_View_Admin_As.prefix).removeClass("fullPopupActive");$(root_prefix+"-quickselect > .ab-sub-wrapper").removeClass("fullPopup")});$(document).on("change",root_prefix+" .ab-vaa-select.select-role-caps select",function(){VAA_View_Admin_As.caps_filter_settings.selectedRole=$(this).val();if(VAA_View_Admin_As.caps_filter_settings.selectedRole=="default"){VAA_View_Admin_As.caps_filter_settings.selectedRoleCaps={};VAA_View_Admin_As.caps_filter_settings.selectedRoleReverse=false}else{var selectedRoleElement=$(root_prefix+'-selectrolecaps #vaa-caps-selectrolecaps option[value="'+VAA_View_Admin_As.caps_filter_settings.selectedRole+'"]');VAA_View_Admin_As.caps_filter_settings.selectedRoleCaps=JSON.parse(selectedRoleElement.attr("data-caps"));VAA_View_Admin_As.caps_filter_settings.selectedRoleReverse=1===parseInt(selectedRoleElement.attr("data-reverse"),10)}VAA_View_Admin_As.filter_capabilities()});$(document).on("keyup",root_prefix+" .ab-vaa-filter input",function(){if(1<=$(this).val().length){VAA_View_Admin_As.caps_filter_settings.filterString=$(this).val()}else{VAA_View_Admin_As.caps_filter_settings.filterString=""}VAA_View_Admin_As.filter_capabilities()});$(document).on("click touchend",root_prefix+" button#select-all-caps",function(e){if(true===VAA_View_Admin_As._touchmove){return}e.preventDefault();$(root_prefix+"-quickselect-options .vaa-cap-item").each(function(){if($(this).is(":visible")){$("input",this).prop("checked",true)}});return false});$(document).on("click touchend",root_prefix+" button#deselect-all-caps",function(e){if(true===VAA_View_Admin_As._touchmove){return}e.preventDefault();$(root_prefix+"-quickselect-options .vaa-cap-item").each(function(){if($(this).is(":visible")){$("input",this).prop("checked",false)}});return false});$(document).on("click touchend",root_prefix+" button#apply-caps-view",function(e){if(true===VAA_View_Admin_As._touchmove){return}e.preventDefault();var newCaps={};$(root_prefix+"-quickselect-options .vaa-cap-item input").each(function(){if($(this).is(":checked")){newCaps[$(this).attr("value")]=1}else{newCaps[$(this).attr("value")]=0}});VAA_View_Admin_As.ajax({caps:newCaps},true);return false})};VAA_View_Admin_As.init_module_role_defaults=function(){var root=VAA_View_Admin_As.root+"-settings",prefix="vaa-settings",root_prefix=VAA_View_Admin_As.prefix+root;$(document).on("change",root_prefix+"-role-defaults-enable input#"+prefix+"-role-defaults-enable",function(e){e.preventDefault();var viewAs={role_defaults:{enable:0}};if(this.checked){viewAs={role_defaults:{enable:true}}}VAA_View_Admin_As.ajax(viewAs,true)});root=VAA_View_Admin_As.root+"-role-defaults";prefix="vaa-role-defaults";root_prefix=VAA_View_Admin_As.prefix+root;$(document).on("change",root_prefix+"-setting-register-enable input#"+prefix+"-setting-register-enable",function(e){e.preventDefault();var viewAs={role_defaults:{apply_defaults_on_register:0}};if(this.checked){viewAs={role_defaults:{apply_defaults_on_register:true}}}VAA_View_Admin_As.ajax(viewAs,false)});$(document).on("change",root_prefix+"-setting-disable-user-screen-options input#"+prefix+"-setting-disable-user-screen-options",function(e){e.preventDefault();var viewAs={role_defaults:{disable_user_screen_options:0}};if(this.checked){viewAs={role_defaults:{disable_user_screen_options:true}}}VAA_View_Admin_As.ajax(viewAs,false)});$(document).on("change",root_prefix+"-setting-lock-meta-boxes input#"+prefix+"-setting-lock-meta-boxes",function(e){e.preventDefault();var viewAs={role_defaults:{lock_meta_boxes:0}};if(this.checked){viewAs={role_defaults:{lock_meta_boxes:true}}}VAA_View_Admin_As.ajax(viewAs,false)});$(document).on("click touchend",root_prefix+"-meta-add button#"+prefix+"-meta-add",function(e){if(true===VAA_View_Admin_As._touchmove){return}e.preventDefault();var val=$(root_prefix+"-meta-add input#"+prefix+"-meta-new").val();var item=$(root_prefix+"-meta-add #"+prefix+"-meta-template").html().toString();item=item.replace(/vaa_new_item/g,val.replace(/ /g,"_"));$(root_prefix+"-meta-select > .ab-item").prepend(item)});$(document).on("click touchend",root_prefix+"-meta-apply button#"+prefix+"-meta-apply",function(e){if(true===VAA_View_Admin_As._touchmove){return}e.preventDefault();var val={};$(root_prefix+"-meta-select .ab-item.vaa-item input").each(function(){val[$(this).val()]=$(this).is(":checked")});if(val){var viewAs={role_defaults:{update_meta:val}};VAA_View_Admin_As.ajax(viewAs,false)}return false});$(document).on("keyup",root_prefix+"-bulk-users-filter input#"+prefix+"-bulk-users-filter",function(e){e.preventDefault();if($(this).val().length>=1){var inputText=$(this).val();$(root_prefix+"-bulk-users-select .ab-item.vaa-item").each(function(){var name=$(".user-name",this).text();if(name.toLowerCase().indexOf(inputText.toLowerCase())>-1){$(this).show()}else{$(this).hide()}})}else{$(root_prefix+"-bulk-users-select .ab-item.vaa-item").each(function(){$(this).show()})}});$(document).on("click touchend",root_prefix+"-bulk-users-apply button#"+prefix+"-bulk-users-apply",function(e){if(true===VAA_View_Admin_As._touchmove){return}e.preventDefault();var val=[];$(root_prefix+"-bulk-users-select .ab-item.vaa-item input").each(function(){if($(this).is(":checked")){val.push($(this).val())}});if(val){var viewAs={role_defaults:{apply_defaults_to_users:val}};VAA_View_Admin_As.ajax(viewAs,false)}return false});$(document).on("click touchend",root_prefix+"-bulk-roles-apply button#"+prefix+"-bulk-roles-apply",function(e){if(true===VAA_View_Admin_As._touchmove){return}e.preventDefault();var val=$(root_prefix+"-bulk-roles-select select#"+prefix+"-bulk-roles-select").val();if(val&&""!==val){var viewAs={role_defaults:{apply_defaults_to_users_by_role:val}};VAA_View_Admin_As.ajax(viewAs,false)}return false});$(document).on("click touchend",root_prefix+"-clear-roles-apply button#"+prefix+"-clear-roles-apply",function(e){if(true===VAA_View_Admin_As._touchmove){return}e.preventDefault();var val=$(root_prefix+"-clear-roles-select select#"+prefix+"-clear-roles-select").val();if(val&&""!==val){var viewAs={role_defaults:{clear_role_defaults:val}};if(confirm(VAA_View_Admin_As.__confirm)){VAA_View_Admin_As.ajax(viewAs,false)}}return false});$(document).on("click touchend",root_prefix+"-export-roles-export button#"+prefix+"-export-roles-export",function(e){if(true===VAA_View_Admin_As._touchmove){return}e.preventDefault();var val=$(root_prefix+"-export-roles-select select#"+prefix+"-export-roles-select").val();if(val&&""!==val){var viewAs={role_defaults:{export_role_defaults:val}};VAA_View_Admin_As.ajax(viewAs,false)}return false});$(document).on("click touchend",root_prefix+"-import-roles-import button.vaa-import-role-defaults",function(e){if(true===VAA_View_Admin_As._touchmove){return}e.preventDefault();var val=$(root_prefix+"-import-roles-input textarea#"+prefix+"-import-roles-input").val();if(val&&""!==val){try{val=JSON.parse(val);var viewAs={role_defaults:{import_role_defaults:val}};if($(this).attr("data-method")){viewAs.role_defaults.import_role_defaults_method=String($(this).attr("data-method"))}VAA_View_Admin_As.ajax(viewAs,false)}catch(err){alert(err)}}return false})};if("undefined"!==typeof VAA_View_Admin_As._vaa_nonce){VAA_View_Admin_As.init()}})(jQuery);