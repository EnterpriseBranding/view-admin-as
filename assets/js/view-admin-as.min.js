/**
 * View Admin As
 * https://wordpress.org/plugins/view-admin-as/
 * 
 * @author Jory Hogeveen <info@keraweb.nl>
 * @package view-admin-as
 * @version 1.5.2
 */

;!function(e){"undefined"==typeof VAA_View_Admin_As&&(VAA_View_Admin_As={}),VAA_View_Admin_As.prefix="#wpadminbar #wp-admin-bar-view-as ","undefined"==typeof VAA_View_Admin_As._debug?VAA_View_Admin_As._debug=0:VAA_View_Admin_As._debug=parseInt(VAA_View_Admin_As._debug),"undefined"==typeof VAA_View_Admin_As.ajaxurl&&"undefined"!=typeof ajaxurl&&(VAA_View_Admin_As.ajaxurl=ajaxurl),VAA_View_Admin_As.init=function(){VAA_View_Admin_As.init_caps(),VAA_View_Admin_As.init_roles(),VAA_View_Admin_As.init_users(),VAA_View_Admin_As.init_settings(),VAA_View_Admin_As.init_module_role_defaults(),e(window).load(function(){e(VAA_View_Admin_As.prefix+".ab-vaa-toggle").each(function(){var i=e(this).parent().children().not(".ab-vaa-toggle");e(this).hasClass("active")||i.hide(),e(this).click(function(a){a.preventDefault(),e(this).hasClass("active")?(i.slideUp("fast"),e(this).removeClass("active")):(i.slideDown("fast"),e(this).addClass("active"))})})}),e(document).on("click",VAA_View_Admin_As.prefix+".vaa-reset-item > .ab-item",function(i){return i.preventDefault(),"reload"!=e("button",this).attr("name")?(viewAs={reset:!0},VAA_View_Admin_As.ajax(viewAs,!0),!1):void window.location.reload()})},VAA_View_Admin_As.ajax=function(i,a){e("#wpadminbar .vaa-update").remove(),e("body").append('<div id="vaa-overlay"><span class="vaa-loader-icon" style="background: transparent url(\''+VAA_View_Admin_As.siteurl+"/wp-includes/images/spinner-2x.gif') center center no-repeat; background-size: contain;\"></span></div>"),e("body #vaa-overlay").fadeIn("fast");var t=!1;e(VAA_View_Admin_As.prefix).hasClass("fullPopupActive")&&(t=!0,e(VAA_View_Admin_As.prefix).removeClass("fullPopupActive"));var s={action:"view_admin_as",_vaa_nonce:VAA_View_Admin_As._vaa_nonce,view_admin_as:i};!e(VAA_View_Admin_As.prefix+"#vaa_settings_view_mode_single").is(":checked")||"undefined"==typeof i.caps&&"undefined"==typeof i.role&&"undefined"==typeof i.user?e.post(VAA_View_Admin_As.ajaxurl,s,function(i){1===VAA_View_Admin_As._debug&&console.log(i),"undefined"!=typeof i.success&&!0===i.success?!1===a?"undefined"!=typeof i.data&&"undefined"!=typeof i.data.content?("undefined"==typeof i.data.type&&(i.data.type="default"),"object"!=typeof i.data.content&&(i.data.content=String(i.data.content)),VAA_View_Admin_As.overlay(i.data.content,String(i.data.type))):(e("body #vaa-overlay").addClass("success").fadeOut("fast",function(){e(this).remove()}),VAA_View_Admin_As.notice(VAA_View_Admin_As.__success,"success")):(window.location=window.location.href.replace("?reset-view","").replace("&reset-view",""),window.location.reload()):(e("body #vaa-overlay").addClass("error").fadeOut("fast",function(){e(this).remove()}),!0===t&&e(VAA_View_Admin_As.prefix).addClass("fullPopupActive"),"undefined"!=typeof i.data&&("undefined"!=typeof i.data.content?("undefined"==typeof i.data.type&&(i.data.type="error"),VAA_View_Admin_As.notice(i.data.content,i.data.type)):VAA_View_Admin_As.notice(i.data,"error")))}):(e("body").append('<form id="vaa_single_mode_form" style="display:none;" method="post"></form>'),e("#vaa_single_mode_form").append('<input type="hidden" name="action" value="'+s.action+'">'),e("#vaa_single_mode_form").append('<input type="hidden" name="_vaa_nonce" value="'+s._vaa_nonce+'">'),e("#vaa_single_mode_form").append('<input id="data" type="hidden" name="view_admin_as">'),e("#vaa_single_mode_form #data").val(JSON.stringify(s.view_admin_as)),e("#vaa_single_mode_form").submit())},VAA_View_Admin_As.notice=function(i,a){e("#wp-admin-bar-top-secondary").append('<li class="vaa-update vaa-'+a+'"><span class="remove ab-icon dashicons dashicons-dismiss" style="top: 2px;"></span>'+i+"</li>"),e("#wpadminbar .vaa-update .remove").click(function(){e(this).parent().remove()}),setTimeout(function(){e("#wpadminbar .vaa-update").fadeOut("fast",function(){e(this).remove()})},5e3)},VAA_View_Admin_As.overlay=function(i,a){e("body #vaa-overlay").html('<div class="vaa-overlay-container"><span class="remove dashicons dashicons-dismiss"></span><div class="vaa-response-data"></div></div>'),"textarea"==a?("undefined"!=typeof i.text&&e("body #vaa-overlay .vaa-response-data").append("<p>"+i.text+"</p>"),"undefined"!=typeof i.textareacontent&&(e("body #vaa-overlay .vaa-response-data").append('<textarea style="width: 100%;" readonly>'+i.textareacontent+"</textarea>"),e("body #vaa-overlay .vaa-response-data textarea").click(function(){e(this).select()}))):"errorlist"==a?("undefined"!=typeof i.text&&e("body #vaa-overlay .vaa-response-data").append("<p>"+i.text+"</p>"),"undefined"!=typeof i.errors&&(e("body #vaa-overlay .vaa-response-data").append('<ul class="errorlist"></ul>'),i.errors.forEach(function(i){e("body #vaa-overlay .vaa-response-data .errorlist").append("<li>"+i+"</li>")}))):e("body #vaa-overlay .vaa-response-data").append("<div>"+i+"</div>"),e("#vaa-overlay .vaa-overlay-container .remove").click(function(){e("body #vaa-overlay").fadeOut("fast",function(){e(this).remove()})}),e(document).mouseup(function(i){e("body #vaa-overlay .vaa-overlay-container").each(function(){e(this).is(i.target)||0!==e(this).has(i.target).length||e("body #vaa-overlay").fadeOut("fast",function(){e(this).remove()})})})},VAA_View_Admin_As.init_settings=function(){e(document).on("change",VAA_View_Admin_As.prefix+"#wp-admin-bar-settings-admin-menu-location select#vaa_settings_admin_menu_location",function(i){i.preventDefault();var a=e(this).val();if(a&&""!==a){var t={user_setting:{admin_menu_location:a}};VAA_View_Admin_As.ajax(t,!0)}}),e(document).on("change",VAA_View_Admin_As.prefix+"#wp-admin-bar-settings-view-mode input.radio.vaa_settings_view_mode",function(i){i.preventDefault();var a=e(this).val();if(a&&""!==a){var t={user_setting:{view_mode:a}};VAA_View_Admin_As.ajax(t,!1)}}),e(document).on("change",VAA_View_Admin_As.prefix+"#wp-admin-bar-settings-force-group-users input#vaa_settings_force_group_users",function(e){e.preventDefault();var i={user_setting:{force_group_users:"no"}};this.checked&&(i={user_setting:{force_group_users:"yes"}}),VAA_View_Admin_As.ajax(i,!0)})},VAA_View_Admin_As.init_roles=function(){e(document).on("click",VAA_View_Admin_As.prefix+".vaa-role-item > a.ab-item",function(i){return i.preventDefault(),e(this).parent().hasClass("not-a-view")?void 0:(viewAs={role:String(e(this).attr("rel"))},VAA_View_Admin_As.ajax(viewAs,!0),!1)})},VAA_View_Admin_As.init_users=function(){e(document).on("click",VAA_View_Admin_As.prefix+".vaa-user-item > a.ab-item",function(i){return i.preventDefault(),e(this).parent().hasClass("not-a-view")?void 0:(viewAs={user:parseInt(e(this).attr("rel"))},VAA_View_Admin_As.ajax(viewAs,!0),!1)}),e(document).on("keyup",VAA_View_Admin_As.prefix+"#wp-admin-bar-users .ab-vaa-search.search-users input",function(i){if(e(VAA_View_Admin_As.prefix+" .ab-vaa-search #vaa-searchuser-results").empty(),1<=e(this).val().length){var a=e(this).val();e(VAA_View_Admin_As.prefix+".vaa-user-item").each(function(){var i=e(".ab-item",this).text();if(-1<i.toLowerCase().indexOf(a.toLowerCase())){var t=!1;e(VAA_View_Admin_As.prefix+".ab-vaa-search #vaa-searchuser-results .vaa-user-item .ab-item").each(function(){e(this).text().indexOf(i)>-1&&(t=e(this))});var s=e(this).parents(".vaa-role-item").children(".ab-item").attr("rel");!1!==t&&t.length?t.find(".user-role").text(t.find(".user-role").text().replace(")",", "+s+")")):e(this).clone().appendTo(VAA_View_Admin_As.prefix+".ab-vaa-search #vaa-searchuser-results").children(".ab-item").append(' &nbsp; <span class="user-role">('+s+")</span>")}}),""===e.trim(e(VAA_View_Admin_As.prefix+".ab-vaa-search #vaa-searchuser-results").html())&&e(VAA_View_Admin_As.prefix+".ab-vaa-search #vaa-searchuser-results").append('<div class="ab-item ab-empty-item vaa-not-found">'+VAA_View_Admin_As.__no_users_found+"</div>")}})},VAA_View_Admin_As.init_caps=function(){VAA_View_Admin_As.caps_filter_settings={selectedRole:"default",selectedRoleCaps:{},selectedRoleReverse:!1,filterString:""},VAA_View_Admin_As.filter_capabilities=function(){e(VAA_View_Admin_As.prefix+" #wp-admin-bar-caps-quickselect-options .vaa-cap-item").each(function(){var i;!0===VAA_View_Admin_As.caps_filter_settings.selectedRoleReverse?(e(this).hide(),1<=VAA_View_Admin_As.caps_filter_settings.filterString.length?(i=e(this).text(),-1<i.toLowerCase().indexOf(VAA_View_Admin_As.caps_filter_settings.filterString.toLowerCase())&&e(this).show()):e(this).show(),"default"!=VAA_View_Admin_As.caps_filter_settings.selectedRole&&e("input",this).attr("value")in VAA_View_Admin_As.caps_filter_settings.selectedRoleCaps&&e(this).hide()):(e(this).hide(),("default"==VAA_View_Admin_As.caps_filter_settings.selectedRole||e("input",this).attr("value")in VAA_View_Admin_As.caps_filter_settings.selectedRoleCaps)&&(1<=VAA_View_Admin_As.caps_filter_settings.filterString.length?(i=e(this).text(),-1<i.toLowerCase().indexOf(VAA_View_Admin_As.caps_filter_settings.filterString.toLowerCase())&&e(this).show()):e(this).show()))})},e(document).on("mouseenter",VAA_View_Admin_As.prefix+"#wp-admin-bar-caps-quickselect",function(){e(VAA_View_Admin_As.prefix+"#wp-admin-bar-caps-quickselect-options").css({"max-height":e(window).height()-350+"px"})}),e(document).on("click",VAA_View_Admin_As.prefix+"#wp-admin-bar-caps #open-caps-popup",function(){e(VAA_View_Admin_As.prefix).addClass("fullPopupActive"),e(VAA_View_Admin_As.prefix+"#wp-admin-bar-caps-quickselect > .ab-sub-wrapper").addClass("fullPopup")}),e(document).on("click",VAA_View_Admin_As.prefix+"#wp-admin-bar-caps #close-caps-popup",function(){e(VAA_View_Admin_As.prefix).removeClass("fullPopupActive"),e(VAA_View_Admin_As.prefix+"#wp-admin-bar-caps-quickselect > .ab-sub-wrapper").removeClass("fullPopup")}),e(document).on("change",VAA_View_Admin_As.prefix+"#wp-admin-bar-caps .ab-vaa-select.select-role-caps select",function(){if(VAA_View_Admin_As.caps_filter_settings.selectedRole=e(this).val(),"default"==VAA_View_Admin_As.caps_filter_settings.selectedRole)VAA_View_Admin_As.caps_filter_settings.selectedRoleCaps={},VAA_View_Admin_As.caps_filter_settings.selectedRoleReverse=!1;else{var i=e(VAA_View_Admin_As.prefix+' #wp-admin-bar-selectrolecaps #select-role-caps option[value="'+VAA_View_Admin_As.caps_filter_settings.selectedRole+'"]');VAA_View_Admin_As.caps_filter_settings.selectedRoleCaps=JSON.parse(i.attr("data-caps")),"1"==i.attr("data-reverse")?VAA_View_Admin_As.caps_filter_settings.selectedRoleReverse=!0:VAA_View_Admin_As.caps_filter_settings.selectedRoleReverse=!1}VAA_View_Admin_As.filter_capabilities()}),e(document).on("keyup",VAA_View_Admin_As.prefix+"#wp-admin-bar-caps .ab-vaa-filter input",function(i){1<=e(this).val().length?VAA_View_Admin_As.caps_filter_settings.filterString=e(this).val():VAA_View_Admin_As.caps_filter_settings.filterString="",VAA_View_Admin_As.filter_capabilities()}),e(document).on("click",VAA_View_Admin_As.prefix+"#wp-admin-bar-caps button#select-all-caps",function(i){return e(VAA_View_Admin_As.prefix+"#wp-admin-bar-caps-quickselect-options .vaa-cap-item").each(function(){e(this).is(":visible")&&e("input",this).prop("checked",!0)}),!1}),e(document).on("click",VAA_View_Admin_As.prefix+"#wp-admin-bar-caps button#deselect-all-caps",function(i){return e(VAA_View_Admin_As.prefix+"#wp-admin-bar-caps-quickselect-options .vaa-cap-item").each(function(){e(this).is(":visible")&&e("input",this).prop("checked",!1)}),!1}),e(document).on("click",VAA_View_Admin_As.prefix+"#wp-admin-bar-caps button#apply-caps-view",function(i){var a="";return e(VAA_View_Admin_As.prefix+"#wp-admin-bar-caps-quickselect-options .vaa-cap-item input").each(function(){a+=e(this).is(":checked")?e(this).attr("value")+":1,":e(this).attr("value")+":0,"}),VAA_View_Admin_As.ajax({caps:a},!0),!1})},VAA_View_Admin_As.init_module_role_defaults=function(){e(document).on("change",VAA_View_Admin_As.prefix+"#wp-admin-bar-settings-role-defaults-enable input#vaa_role_defaults_enable",function(e){e.preventDefault();var i={role_defaults:{enable:0}};this.checked&&(i={role_defaults:{enable:!0}}),VAA_View_Admin_As.ajax(i,!0)}),e(document).on("change",VAA_View_Admin_As.prefix+"#wp-admin-bar-role-defaults-setting-register-enable input#vaa_role_defaults_register_enable",function(e){e.preventDefault();var i={role_defaults:{apply_defaults_on_register:0}};this.checked&&(i={role_defaults:{apply_defaults_on_register:!0}}),VAA_View_Admin_As.ajax(i,!1)}),e(document).on("change",VAA_View_Admin_As.prefix+"#wp-admin-bar-role-defaults-setting-disable-user-screen-options input#vaa_role_defaults_disable_user_screen_options",function(e){e.preventDefault();var i={role_defaults:{disable_user_screen_options:0}};this.checked&&(i={role_defaults:{disable_user_screen_options:!0}}),VAA_View_Admin_As.ajax(i,!1)}),e(document).on("keyup",VAA_View_Admin_As.prefix+"#wp-admin-bar-role-defaults-bulk-users-filter input#role-defaults-bulk-users-filter",function(i){if(i.preventDefault(),e(this).val().length>=1){var a=e(this).val();e(VAA_View_Admin_As.prefix+"#wp-admin-bar-role-defaults-bulk-users-select .ab-item.vaa-item").each(function(){var i=e(".user-name",this).text();i.toLowerCase().indexOf(a.toLowerCase())>-1?e(this).show():e(this).hide()})}else e(VAA_View_Admin_As.prefix+"#wp-admin-bar-role-defaults-bulk-users-select .ab-item.vaa-item").each(function(){e(this).show()})}),e(document).on("click",VAA_View_Admin_As.prefix+"#wp-admin-bar-role-defaults-bulk-users-apply button#role-defaults-bulk-users-apply",function(i){i.preventDefault();var a=[];if(e(VAA_View_Admin_As.prefix+"#wp-admin-bar-role-defaults-bulk-users-select .ab-item.vaa-item input").each(function(){e(this).is(":checked")&&a.push(e(this).val())}),a){var t={role_defaults:{apply_defaults_to_users:a}};VAA_View_Admin_As.ajax(t,!1)}return!1}),e(document).on("click",VAA_View_Admin_As.prefix+"#wp-admin-bar-role-defaults-bulk-roles-apply button#role-defaults-bulk-roles-apply",function(i){i.preventDefault();var a=e(VAA_View_Admin_As.prefix+"#wp-admin-bar-role-defaults-bulk-roles-select select#role-defaults-bulk-roles-select").val();if(a&&""!==a){var t={role_defaults:{apply_defaults_to_users_by_role:a}};VAA_View_Admin_As.ajax(t,!1)}return!1}),e(document).on("click",VAA_View_Admin_As.prefix+"#wp-admin-bar-role-defaults-clear-roles-apply button#role-defaults-clear-roles-apply",function(i){i.preventDefault();var a=e(VAA_View_Admin_As.prefix+"#wp-admin-bar-role-defaults-clear-roles-select select#role-defaults-clear-roles-select").val();if(a&&""!==a){var t={role_defaults:{clear_role_defaults:a}};VAA_View_Admin_As.ajax(t,!1)}return!1}),e(document).on("click",VAA_View_Admin_As.prefix+"#wp-admin-bar-role-defaults-export-roles-export button#role-defaults-export-roles-export",function(i){i.preventDefault();var a=e(VAA_View_Admin_As.prefix+"#wp-admin-bar-role-defaults-export-roles-select select#role-defaults-export-roles-select").val();if(a&&""!==a){var t={role_defaults:{export_role_defaults:a}};VAA_View_Admin_As.ajax(t,!1)}return!1}),e(document).on("click",VAA_View_Admin_As.prefix+"#wp-admin-bar-role-defaults-import-roles-import button#role-defaults-import-roles-import",function(i){i.preventDefault();var a=e(VAA_View_Admin_As.prefix+"#wp-admin-bar-role-defaults-import-roles-input textarea#role-defaults-import-roles-input").val();if(a&&""!==a){var t={role_defaults:{import_role_defaults:a}};VAA_View_Admin_As.ajax(t,!1)}return!1})},"undefined"!=typeof VAA_View_Admin_As._vaa_nonce&&VAA_View_Admin_As.init()}(jQuery);